


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Percolation Simulator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    label, input {
      display: block;
      margin: 10px 0;
    }
    input[type="number"] {
      width: 100px;
    }
    #result, #theoretical {
      font-weight: bold;
      margin-top: 20px;
    }
    #gridDisplay {
      margin-top: 20px;
      display: inline-block;
      border: 1px solid #ccc;
    }
    .row {
      display: flex;
    }
    .cell {
      width: 20px;
      height: 20px;
      border: 1px solid #ddd;
    }
    .open {
      background-color: #aef;
    }
    .blocked {
      background-color: #333;
    }
  </style>
</head>
<body>
  <h1>Percolation Probability Simulator</h1>

  <label>Number of columns (X):
    <input type="number" id="columns" value="8" min="1" />
  </label>
  <label>Number of cells in each column (Y):
    <input type="number" id="rows" value="8" min="1" />
  </label>
  <label>Probability of water passing each cell (P, 0-1):
    <input type="number" id="probability" value="0.5" min="0" max="1" step="0.01" />
  </label>
  <label>Number of cycles (N):
    <input type="number" id="cycles" value="10000" min="1" />
  </label>

  <button onclick="runSimulation()">Run Simulation</button>

  <div id="gridDisplay"></div>
  <div id="result"></div>
  <div id="theoretical"></div>

  <script>
    function runSimulation() {
      const X = parseInt(document.getElementById("columns").value);
      const Y = parseInt(document.getElementById("rows").value);
      const P = parseFloat(document.getElementById("probability").value);
      const N = parseInt(document.getElementById("cycles").value);

      let success = 0;

      function createGrid() {
        const grid = [];
        for (let y = 0; y < Y; y++) {
          const row = [];
          for (let x = 0; x < X; x++) {
            row.push(Math.random() < P);
          }
          grid.push(row);
        }
        return grid;
      }

      function hasPercolation(grid) {
        const visited = Array.from({ length: Y }, () => Array(X).fill(false));
        const queue = [];

        for (let x = 0; x < X; x++) {
          if (grid[0][x]) {
            queue.push([0, x]);
            visited[0][x] = true;
          }
        }

        const directions = [
          [-1, 0], [1, 0], [0, -1], [0, 1]
        ];

        while (queue.length > 0) {
          const [y, x] = queue.shift();
          if (y === Y - 1) return true;
          for (const [dy, dx] of directions) {
            const ny = y + dy;
            const nx = x + dx;
            if (ny >= 0 && ny < Y && nx >= 0 && nx < X && grid[ny][nx] && !visited[ny][nx]) {
              visited[ny][nx] = true;
              queue.push([ny, nx]);
            }
          }
        }
        return false;
      }

      // Run simulation
      for (let i = 0; i < N; i++) {
        const grid = createGrid();
        if (hasPercolation(grid)) success++;
      }

      const result = success / N;
      document.getElementById("result").innerText =
        `Monte Carlo result: ${result.toFixed(4)} (based on ${N} runs)`;

      const columnFail = 1 - Math.pow(P, Y);
      const allFail = Math.pow(columnFail, X);
      const atLeastOne = 1 - allFail;

      document.getElementById("theoretical").innerText =
        `Theoretical (no interconnection): ${atLeastOne.toFixed(4)}`;

      // Show one random grid
      const oneGrid = createGrid();
      const gridDisplay = document.getElementById("gridDisplay");
      gridDisplay.innerHTML = "";
      for (let y = 0; y < Y; y++) {
        const rowDiv = document.createElement("div");
        rowDiv.className = "row";
        for (let x = 0; x < X; x++) {
          const cellDiv = document.createElement("div");
          cellDiv.className = "cell " + (oneGrid[y][x] ? "open" : "blocked");
          rowDiv.appendChild(cellDiv);
        }
        gridDisplay.appendChild(rowDiv);
      }
    }
  </script>
</body>
</html>
